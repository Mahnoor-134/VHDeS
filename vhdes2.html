<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="VHDeS.css" />
    <title>Document</title>
</head>

<body>

    <h1> Vi Hyr Dig elScooter!</h1>

    <h2 id="welcome">Välkommen!</h2>
    <div id="bookingBox" class="available">

        <h3>Här kan du hyra en elscooter
            Minst 5 minuter till max 2 timmar.
        </h3>

        <p>Tider:</p>

        <div>
            <p>Ange starttid: <input type="time" id="starttid"></p>
            <p>Ange sluttid: <input type="time" id="sluttid"></p>
        </div>
        <div id="resultat"> </div>
        <p id="pricePreview"></p>


        <button id="hyra"> Hyra </button>
        <button id="cancel" disabled>Avsluta hyra</button>
    </div>

    <p id="kvitto"> </p>

    <script>
        const pricePerMinut = 3;
        let isBooked = false;
        let bookingTimer;

        let timmer = 0;
        let isAutoKnappActiv = false;
        let hyrt = true;
        let clickInterval;

        const params = new URLSearchParams(window.location.search);
        const text = document.getElementById("welcome");
        let username = params.get('username');
        if (username) {
            text.textContent = `Välkommen ${username}!`;
        }


        const hyra = document.getElementById('hyra');
        const kvittoText = document.getElementById('kvitto');

        hyra.addEventListener('click', function () {

            const product = { name: 'elscoter', pris: '150 kr' };
            const tid = new Date().toLocaleTimeString();
            const date = new Date().toLocaleDateString();

            if (isBooked) {
                alert("Du har redan en aktiv bokning!");
                return;
            }
            let start = document.getElementById('starttid').value;
            let slut = document.getElementById('sluttid').value;

            if (!start || !slut) {
                alert("Vänligen fyll i båda tiderna först!");
                return;
            }

          
            //om man har valt rätt tid så visar den tiderna 
            document.getElementById("resultat").innerText =
                `Du har bokat från  ${start} till ${slut}`;


            kvittoText.textContent = `Bokat! Du hyr nu en  ${product.name} för ${product.pris}. (Tid: ${tid}). (Datum: ${date})`;



            alert('Tack! Du har nu hyrt en ' + product.name + ' för ' + product.pris);
            console.log('Köp genomfört: ', product);


            if (!isAutoKnappActiv) {
                isAutoKnappActiv = true;
                hyrt = true;

                clickInterval = setInterval(function () {
                    timmer++;

                    text.textContent = timmer;
                }, 1000);
                ;
            } else {

                isAutoKnappActiv = false;
                // isAutoKnappActiv = 6; 
                clearInterval(clickInterval);
            };

        });

        document.getElementById("val").addEventListener("click", function () {
            // det från chatgtp
            // Gör om tiderna till Date-objekt
            let startTid = new Date("1970-01-01T" + start);
            let slutTid = new Date("1970-01-01T" + slut);

            // Räkna skillnad i minuter
            let skillnad = (slutTid - startTid) / (1000 * 60);

            // Kontrollera om sluttiden är före starttiden
            if (skillnad <= 0) {
                alert("Sluttiden måste vara efter starttiden!");
                return;
            }

            // Kontroll: minst 5 minuter och max 120 minuter
            if (skillnad < 5 || skillnad > 120) {
                alert("Du kan boka minst 5 minuter och max 2 timmar!");
                return;
            }


        });



    </script>


</body>

</html>